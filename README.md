# Build and deploy apps to Kubernetes engine

## Prerequisites

1. A working Docker installation – https://store.docker.com/editions/community/docker-ce-desktop-mac
2. Google Cloud SDK `gcloud` – https://cloud.google.com/sdk/docs/quickstart-macos

## Installing

### Option 1 – prebuilt
1. Ensure you have `~/.bin` directory or similar that is in your `$PATH`
1. `curl -L https://github.com/voormedia/kd/releases/download/v1.1.3/darwin_amd64_kd -o ~/.bin/kd && chmod +x ~/.bin/kd`

### Option 2 – from source
1. Make sure you have a working `go` installation
2. `go install github.com/voormedia/kd`


## Best practices for deploying

### Step 1 – adjust your app

* Configure the app to run with an application server (e.g. with `puma` for Rails).
* Make your app log to stdout/stderr instead of log files. Preferably in Google cloud compatible JSON.

### Step 2 – write a Dockerfile

* Make sure your image is small. Use a two-step build process. Use `.dockerignore` to exclude unused files.
* See https://github.com/voormedia/docker-base-images/tree/master/_examples for examples.

### Step 3 – configure deployment

* Run `kd init` and input the project details.
* Review the generated configuration and adjust where necessary.

### Step 4 – configure cloud services

* Create a PostgreSQL user and database if necessary. Use the same naming conventions as generated by `kd` in step 2. Create a secret from the service account key.

### Step 5 – deploy

* Use `kd deploy` to deploy to a target.
